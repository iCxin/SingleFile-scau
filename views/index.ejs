<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁΩëÈ°µÂ≠òÊ°£Á¥¢Âºï</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        /* Search and Controls */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        .search-box input {
            width: 100%;
            padding: 12px 15px;
            padding-left: 40px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s;
            box-sizing: border-box;
        }
        .search-box input:focus {
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.2);
        }
        .search-box::before {
            content: "üîç";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 14px;
        }
        .count-info {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e1e1e1;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #555;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s;
        }
        th:hover {
            background-color: #e9ecef;
        }
        th.sort-asc::after {
            content: " ‚ñ≤";
            display: inline-block;
            margin-left: 5px;
            font-size: 0.8em;
            color: #3498db;
        }
        th.sort-desc::after {
            content: " ‚ñº";
            display: inline-block;
            margin-left: 5px;
            font-size: 0.8em;
            color: #3498db;
        }
        tr:hover {
            background-color: #f1f3f5;
        }
        a {
            text-decoration: none;
            color: #3498db;
            font-weight: 500;
            transition: color 0.2s;
            display: block;
        }
        a:hover {
            color: #2980b9;
            text-decoration: underline;
        }
        
        .datetime-col {
            width: 200px;
            color: #7f8c8d;
            font-variant-numeric: tabular-nums;
            white-space: nowrap;
        }
        .title-col {
            /* Takes remaining space */
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            background: #f9f9f9;
            border-radius: 4px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ÁΩëÈ°µÂ≠òÊ°£Á¥¢Âºï</h1>
        
        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="ÊêúÁ¥¢Ê†áÈ¢ò„ÄÅÊó•ÊúüÊàñÊó∂Èó¥..." oninput="handleSearch()">
            </div>
            <div class="count-info" id="countInfo">
                ÂÖ± <%= files.length %> ‰∏™Êñá‰ª∂
            </div>
        </div>

        <table id="fileTable">
            <thead>
                <tr>
                    <th class="datetime-col" onclick="handleSort('timestamp')">Êó•ÊúüÊó∂Èó¥</th>
                    <th class="title-col" onclick="handleSort('title')">Ê†áÈ¢ò</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- Content will be populated by JS -->
            </tbody>
        </table>
        
        <div id="emptyState" class="empty-state" style="display: none;">
            <p>Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÊñá‰ª∂„ÄÇ</p>
        </div>
    </div>

    <script>
        // Data from server
        let filesData = <%- JSON.stringify(files) %>;
        let currentSort = { field: 'timestamp', direction: 'desc' }; // Default sort
        
        const tableBody = document.getElementById('tableBody');
        const emptyState = document.getElementById('emptyState');
        const countInfo = document.getElementById('countInfo');
        const headers = document.querySelectorAll('th');

        function renderTable(data) {
            tableBody.innerHTML = '';
            
            if (data.length === 0) {
                document.getElementById('fileTable').style.display = 'none';
                emptyState.style.display = 'block';
                // Only update count text if it's a search result empty state, 
                // but usually we want to show "0 matches" or similar.
                // Here we stick to showing total count in header or filtered count?
                // Let's show filtered count.
                countInfo.textContent = `ÊâæÂà∞ 0 ‰∏™Êñá‰ª∂`;
                return;
            }
            
            document.getElementById('fileTable').style.display = 'table';
            emptyState.style.display = 'none';
            countInfo.textContent = `ÂÖ± ${data.length} ‰∏™Êñá‰ª∂`;

            data.forEach(file => {
                const tr = document.createElement('tr');
                
                const tdDate = document.createElement('td');
                tdDate.className = 'datetime-col';
                // Format: YYYY-MM-DD HH:mm:ss
                tdDate.textContent = `${file.date} ${file.time}`;
                
                const tdTitle = document.createElement('td');
                tdTitle.className = 'title-col';
                const a = document.createElement('a');
                a.href = `/HTML/${file.filename}`;
                a.target = '_blank';
                a.textContent = file.title;
                tdTitle.appendChild(a);
                
                tr.appendChild(tdDate);
                tr.appendChild(tdTitle);
                tableBody.appendChild(tr);
            });
        }

        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            
            // Filter data
            const filtered = filesData.filter(file => {
                const searchStr = `${file.date} ${file.time} ${file.title}`.toLowerCase();
                return searchStr.includes(query);
            });
            
            // Apply current sort to filtered results
            sortData(filtered, currentSort.field, currentSort.direction);
        }

        function handleSort(field) {
            // Toggle direction if same field, otherwise default to desc for timestamp, asc for title
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                // Default directions
                currentSort.direction = field === 'timestamp' ? 'desc' : 'asc';
            }

            updateSortIndicators(field, currentSort.direction);

            // Re-run filter to get current dataset
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            const filtered = filesData.filter(file => {
                const searchStr = `${file.date} ${file.time} ${file.title}`.toLowerCase();
                return searchStr.includes(query);
            });
            
            sortData(filtered, field, currentSort.direction);
        }

        function updateSortIndicators(activeField, direction) {
            headers.forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
                const onClick = th.getAttribute('onclick');
                if (onClick && onClick.includes(`'${activeField}'`)) {
                    th.classList.add(`sort-${direction}`);
                }
            });
        }

        function sortData(data, field, direction) {
            data.sort((a, b) => {
                let valA = a[field];
                let valB = b[field];
                
                if (typeof valA === 'string') valA = valA.toLowerCase();
                if (typeof valB === 'string') valB = valB.toLowerCase();

                if (valA < valB) return direction === 'asc' ? -1 : 1;
                if (valA > valB) return direction === 'asc' ? 1 : -1;
                return 0;
            });
            renderTable(data);
        }

        // Initial Setup
        // Mark the default sort column
        updateSortIndicators('timestamp', 'desc');
        // Render initial data
        renderTable(filesData);
    </script>
</body>
</html>
